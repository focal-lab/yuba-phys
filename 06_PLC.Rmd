---
title: "06_PLC"
author: "Anjum K. Gujral"
date: '2024-08-25'
output: html_document
---

```{r}
install.packages('janitor')
library(janitor)
install.packages('here')
library(here)
install.packages('lubridate')
library(lubridate)
install.packages('readxl')
library(readxl)
library(gridExtra)
library(MetBrewer)
library(dlookr)
install.packages('beeswarm')
library(beeswarm)
library(tidyverse)
geom_beeswarm = ggbeeswarm::geom_beeswarm()
here = here::here()
#install.packages("updater")
#library(updater)
#updater::r_version()
library(scales)
library(gridExtra)
#install.packages("Rmisc")
library(Rmisc)
#install.packages("fitplc")
library(ggrepel)
library(boot)
library(DEoptim)
library(devtools)
library(quickpsy)
library(fitplc)
library(dplyr)

```

```{r}
DATADIR = "/Users/anjumgujral/Box Sync/yuba-phys_data/P50"

cavitron_files <- list.files(path = here::here("P50", "P50_individual"), pattern = "*.csv", full.names = TRUE, include.dirs = T, recursive = T) 

# Read and combine CSV files
all_cavitron_data<- cavitron_files %>%
  map_dfr(~read_csv(.x, skip = 1, col_names = read_csv(.x, n_max = 1)))


# Assuming you have a combined dataframe called combined_data

# Initialize an empty list to store individual dataframes
dataframes <- list()

# Initialize a variable to keep track of the current header
current_header <- NULL

some_condition <- function(row) {
  # Check if the first cell in the row contains "Date_time" (case insensitive)
  first_cell <- as.character(row[1])
  return(grepl("Date_time", first_cell, ignore.case = TRUE))
}

# Loop through rows in combined_data
for (i in 1:nrow(all_cavitron_data)) {
  # Check if the current row could be a header (you can customize this condition)
  if (some_condition(all_cavitron_data[i, ])) {
    # Set the current row as the column names
    current_header <- as.character(all_cavitron_data[i, ])
  } else {
    # If it's not a header, create a new dataframe and add it to the list
    if (!is.null(current_header)) {
      dataframes <- append(dataframes, list(
        setNames(all_cavitron_data[i, , drop = FALSE], current_header)
      ))
    }
  }
}

# Combine all the individual dataframes into one
cavitron_df <- do.call(rbind, dataframes) %>% 
  janitor::clean_names() 

vc_all <- cavitron_df %>% 
  janitor::clean_names() %>% 
  drop_na(campaign_name) %>% 
  dplyr::mutate( 
         tree = as.numeric(sample_ref_1), 
         #branch = sample_ref_2,
         mpa = as.numeric(pressure_mpa) * -1,
         pressures = mpa,
         neg_mpa = as.numeric(pressure_mpa),
        k = as.numeric(raw_conductance_kg_mpa_s),
        kstem_length = as.numeric(conductivity_si_corr_t),
        #stem_id = paste(site, tree, branch, sep = "-"),
        plc_new = as.numeric(plc),
        #species = case_when(
    #species %in% c("Abies concolor") ~ "ABCO", 
    #species %in% c("Pinus lambertiana") ~ "PILA", 
    #species %in% c("Calocedrus decurrens") ~ "CADE", 
    #TRUE ~ as.character(species)), 
    type = case_when(speed_class %in% c("a") ~ "kmax", 
                     speed_class %in% c("b", "c","d", "e", "f", "g", "h", "i") ~ "VC", 
      TRUE ~ as.character(speed_class))) %>% 
  select(tree, mpa, neg_mpa, k, kstem_length, plc_new, type) %>% 
  mutate(size = as.factor("B"), 
         plc_new = case_when(
           plc_new < 0 ~ 0, 
           plc_new > 100 ~ 100,
           TRUE ~ as.numeric(plc_new)
         )) %>% 
  drop_na(plc_new)

vc_all2 <- vc_all %>% 
  group_by(tree) %>% 
  mutate(group = case_when(
    mpa == min(mpa) ~ "a",
    TRUE ~ as.character("b"))) %>% 
  group_by(tree) %>% 
  mutate(mean_kstem_a = mean(kstem_length[group == 'a'], na.rm = T)) %>% 
  ungroup() %>% 
  mutate(plc_new = 100-(100*kstem_length/mean_kstem_a))%>% 
  drop_na(plc_new)

```

```{r}
#Have to do each tree individually and remove the ones that do not work: 

stemID <- subset(vc_all2, vc_all2$tree =="209.1")
# Convert all numeric columns to avoid scientific notation
#stemID <- stemID %>%
  #mutate(k = format(k, scientific = FALSE))
#pfit <- fitplc(stemID, varnames=c(PLC="plc_new", WP="mpa"), nboot=50)

stemID <- stemID %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  # Create valid_data based on plc_new >= 0

# Fit the model using only rows where plc_new >= 0
pfit <- fitplc(stemID %>% filter(valid_data == TRUE), varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 50)

# Plot the fitted model
plot(pfit, 
     xlim = c(0,7),
     ylim = c(0,1))

# Access the fitted coefficients
coefficients <- coef(pfit)
print(coefficients)

```

#PILA P50
##PILA -- low elevation 
```{r}
PILA_low_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("5001","5007","177","207")))

PILA_low_sun_seedling <- PILA_low_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

PILA_low_sun_seedling <- PILA_low_sun_seedling %>% filter(valid_data == TRUE)

PILA_low_sun_seedling_cleaned <- 
  PILA_low_sun_seedling %>%  filter(!row_number() %in% c(2, 4, 6, 8, 16, 17, 18, 19, 38, 42, 44, 45, 49, 55, 60, 62, 64, 68))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_low_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA low elevation, sun exposed seedling",
     legend = TRUE,
     xlim = c(0.5, 5.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

#output:   
#mean_P50 mean_lwr mean_upr
#3.946345 3.890444 3.994102
```

```{r}
PILA_low_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("5010","31","5011", "151.1", "5014")))
  
PILA_low_shade_seedling <- PILA_low_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

PILA_low_shade_seedling <- PILA_low_shade_seedling %>% filter(valid_data == TRUE)

PILA_low_shade_seedling_cleaned <- 
  PILA_low_shade_seedling %>%  filter(!row_number() %in% c(4, 7, 8, 9, 12, 19, 26, 27, 29, 30, 31, 66, 67, 70, 74, 89, 91, 93, 94, 95, 96, 105, 106, 108, 109, 110))

PILA_low_shade_seedling_cleaned <- 
  PILA_low_shade_seedling_cleaned %>%  filter(!row_number() %in% c(89-12))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_low_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA low elevation, shaded seedling",
     legend = TRUE,
     xlim = c(0.5, 6.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.420236 3.346096 3.491153

```

```{r}
PILA_low_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("202.2", "23.2")))

#202.1 <- curve is fine but unrealistic value (-5), maybe cuvette broke

PILA_low_sun_sapling <- PILA_low_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PILA_low_sun_sapling <- PILA_low_sun_sapling %>% filter(valid_data == TRUE)

PILA_low_sun_sapling_cleaned <- 
  PILA_low_sun_sapling %>%  filter(!row_number() %in% c(20, 33, 38))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_low_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA low elevation, sun exposed sapling",
     legend = TRUE,
     xlim = c(0.5, 6.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.035791 3.884941 4.045471

```

```{r}
PILA_low_shade_sapling <-vc_all2 %>% 
  filter((tree %in% c("8.1","8.2", "170.1", "46.1", "46.2", "43.2")))

# 170.2 
#43.2

PILA_low_shade_sapling <- PILA_low_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PILA_low_shade_sapling <- PILA_low_shade_sapling %>% filter(valid_data == TRUE)

PILA_low_shade_sapling_cleaned <- 
  PILA_low_shade_sapling %>%  filter(!row_number() %in% c(8, 165, 166, 168, 204))
 
# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_low_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA low elevation, shaded sapling",
     legend = TRUE,
     xlim = c(0.5,5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.096779 3.066328 3.126015

```

##PILA -- high elevation 
```{r}
PILA_high_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("267", "243","301")))

PILA_high_sun_seedling <- PILA_high_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

PILA_high_sun_seedling <- PILA_high_sun_seedling %>% filter(valid_data == TRUE)

PILA_high_sun_seedling_cleaned <- 
  PILA_high_sun_seedling %>%  filter(!row_number() %in% c(22, 23, 27, 28, 33))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_high_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA high elevation, sun exposed seedling",
     legend = TRUE,
     xlim = c(0.5,6),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

#  mean_P50 mean_lwr mean_upr
# 3.980955 3.872629 4.055284
```

```{r}
PILA_high_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("133", "279", "292")))

#254.1

PILA_high_shade_seedling <- PILA_high_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PILA_high_shade_seedling <- PILA_high_shade_seedling %>% filter(valid_data == TRUE)

PILA_high_shade_seedling_cleaned <- 
  PILA_high_shade_seedling %>%  filter(!row_number() %in% c(1, 2, 3, 4, 5, 8, 9, 10, 11, 23, 42, 45, 46, 63, 64,65, 67, 68, 70, 71, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 87, 96, 102, 103, 105))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_high_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA high elevation, shaded seedling",
     legend = TRUE,
     xlim = c(0.5,6.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.949126 3.861037 4.002805
```

```{r}
PILA_high_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("216.1", "216.2", "266.2", "248.1","293.1", "266.1")))

# 248.2, 266.1

PILA_high_sun_sapling <- PILA_high_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PILA_high_sun_sapling <- PILA_high_sun_sapling %>% filter(valid_data == TRUE)

PILA_high_sun_sapling_cleaned <- 
  PILA_high_sun_sapling %>%  filter(!row_number() %in% c(40,42, 97, 70, 71, 103, 104))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_high_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA high elevation, sun exposed sapling",
     legend = TRUE,
     xlim = c(0.5,6),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.405015 3.353651 3.447618

```

```{r}
PILA_high_shade_sapling <-vc_all2 %>% 
  filter((tree %in% c("239.1", "286.1", "284.1")))

# "143.1",  "83.1", 

PILA_high_shade_sapling <- PILA_high_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PILA_high_shade_sapling <- PILA_high_shade_sapling %>% filter(valid_data == TRUE)

PILA_high_shade_sapling_cleaned <- 
  PILA_high_shade_sapling %>%  filter(!row_number() %in% c(1,2, 19, 20, 21, 22, 23, 24, 25,30,31, 45, 50, 52, 59, 61))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PILA_high_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PILA high elevation, shaded sapling",
     legend = TRUE,
     ylim = c(0,1),
     xlim = c(0.5,6))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.378291 3.197237 3.415031

```


#PIPO P50
##PIPO-- low elevation 
```{r}
PIPO_low_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("5003","5004","5009")))

PIPO_low_sun_seedling <- PIPO_low_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

PIPO_low_sun_seedling <- PIPO_low_sun_seedling %>% filter(valid_data == TRUE)

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_low_sun_seedling, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO low elevation, sun exposed seedling",
     legend = TRUE)

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))
```

```{r}
PIPO_low_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("5012")))

#162
  
PIPO_low_shade_seedling <- PIPO_low_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_low_shade_seedling <- PIPO_low_shade_seedling %>% filter(valid_data == TRUE)

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_low_shade_seedling, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO low elevation, shaded seedling",
     legend = FALSE,
     xlim = c(0.5,6),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.587392 4.543307 4.633422

```

```{r}
PIPO_low_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("10.2", "24.1", "24.2", "180.1", "180.2")))

#10.1

PIPO_low_sun_sapling <- PIPO_low_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_low_sun_sapling <- PIPO_low_sun_sapling %>% filter(valid_data == TRUE)

PIPO_low_sun_sapling_cleaned <- 
  PIPO_low_sun_sapling %>%  filter(!row_number() %in% c(5, 56, 57, 61, 87, 120, 122, 123, 131, 132, 133, 144, 145, 146, 147, 148, 151, 152))

PIPO_low_sun_sapling_cleaned <- PIPO_low_sun_sapling_cleaned[32:161, ]

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_low_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO low elevation, sun exposed sapling",
     legend = TRUE,
     xlim = c(0.5,6.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.244883 4.205137 4.280323
```

```{r}
PIPO_low_shade_sapling <-vc_all2 %>% 
  filter((tree %in% c("34.2","178.1", "55.2", "119.1")))

#45.1, 45.2

PIPO_low_shade_sapling <- PIPO_low_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_low_shade_sapling <- PIPO_low_shade_sapling %>% filter(valid_data == TRUE)

PIPO_low_shade_sapling_cleaned <- 
  PIPO_low_shade_sapling %>%  filter(!row_number() %in% c(4, 28, 48))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_low_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO low elevation, shaded sapling",
     legend = TRUE,
     xlim= c(0.5,6),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.198861 4.143742 4.252357
```

##PIPO-- high elevation 
```{r}
PIPO_high_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("217", "300", "277")))

#138, 277

PIPO_high_sun_seedling <- PIPO_high_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

PIPO_high_sun_seedling <- PIPO_high_sun_seedling %>% filter(valid_data == TRUE)

PIPO_high_sun_seedling_cleaned <- 
  PIPO_high_sun_seedling %>%  filter(!row_number() %in% c(8, 23, 24, 25, 28, 30))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_high_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO high elevation, sun exposed seedling",
     legend = TRUE)

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.19564 4.102608 4.239264
```

```{r}
PIPO_high_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("288.1","294.1")))
  
PIPO_high_shade_seedling <- PIPO_high_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_high_shade_seedling <- PIPO_high_shade_seedling %>% filter(valid_data == TRUE)

PIPO_high_shade_seedling_cleaned <- 
  PIPO_high_shade_seedling %>%  filter(!row_number() %in% c(1, 6, 7, 9, 15, 21, 25, 27, 28))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_high_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO high elevation, shaded seedling",
     legend = TRUE,
     xlim = c(0.5, 6),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.933056 3.880984 3.996827
```

```{r}
PIPO_high_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("146.1", "226.2", "237.1")))

#146.2, 274.1, 274.2

PIPO_high_sun_sapling <- PIPO_high_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_high_sun_sapling <- PIPO_high_sun_sapling %>% filter(valid_data == TRUE)

PIPO_high_sun_sapling_cleaned <- 
  PIPO_high_sun_sapling %>%  filter(!row_number() %in% c(31))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_high_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO high elevation, sun exposed sapling",
     legend = TRUE)

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.043665 3.906704 4.095981

```

```{r}
PIPO_high_shade_sapling <-vc_all2 %>% 
  filter((tree %in% c("258.1", "296.2")))

#296.1

PIPO_high_shade_sapling <- PIPO_high_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
PIPO_high_shade_sapling <- PIPO_high_shade_sapling %>% filter(valid_data == TRUE)

PIPO_high_shade_sapling_cleaned <- 
  PIPO_high_shade_sapling %>%  filter(!row_number() %in% c(1))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(PIPO_high_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "PIPO high elevation, shaded sapling",
     legend = TRUE, 
     ylim = c(0,1),
     xlim = c(0.5, 6))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.463569 3.417393 3.552126

```

#ABCO P50
##ABCO -- low elevation
```{r}
ABCO_low_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("5008","167","164")))

ABCO_low_sun_seedling <- ABCO_low_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

ABCO_low_sun_seedling <- ABCO_low_sun_seedling %>% filter(valid_data == TRUE)

ABCO_low_sun_seedling_cleaned <- 
  ABCO_low_sun_seedling %>%  filter(!row_number() %in% c(1, 5, 44, 45, 65))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_low_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO low elevation, sun exposed seedling",
     legend = TRUE,
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.584102 4.421904 4.625231

```

```{r}
ABCO_low_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("5006", "33", "153")))

#5002 <- good curve but very low P50 (-5.5), maybe cuvette broke?
  
ABCO_low_shade_seedling <- ABCO_low_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_low_shade_seedling <- ABCO_low_shade_seedling %>% filter(valid_data == TRUE)

ABCO_low_shade_seedling_cleaned <-   ABCO_low_shade_seedling %>%  filter(!row_number() %in% c(5, 6, 7, 8, 18, 20, 21, 22, 68))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_low_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO low elevation, shaded seedling",
     legend = TRUE,
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
#4.48222  4.37921 4.543011
```

```{r}
ABCO_low_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("186.1", "186.2", "150.1", "209.1", "200.1")))

#102.1, 
#200.2 <- good curve but needs kmax reassigned

ABCO_low_sun_sapling <- ABCO_low_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_low_sun_sapling <- ABCO_low_sun_sapling %>% filter(valid_data == TRUE)

ABCO_low_sun_sapling_cleaned <-   ABCO_low_sun_sapling %>%  filter(!row_number() %in% c(2, 18, 20, 102))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_low_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO low elevation, sun exposed sapling",
     legend = TRUE, 
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.486094 4.415758 4.546265

```

```{r}
ABCO_low_shade_sapling <-vc_all2 %>% 
  filter(tree %in% c("175.1", "175.2", "40.1", "40.2","40.3", "51.1","51.2", "118.1", "199.1","199.2"))

#5, 175.1

ABCO_low_shade_sapling <- ABCO_low_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_low_shade_sapling <- ABCO_low_shade_sapling %>% filter(valid_data == TRUE)

ABCO_low_shade_sapling_cleaned <- ABCO_low_shade_sapling %>%  filter(!row_number() %in% c(34, 38, 39, 47, 51, 52, 61, 110))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_low_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO low elevation, shaded sapling",
     legend = TRUE,
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))
```

##ABCO -- high elevation 
```{r}
ABCO_high_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("125.1", "247", "137.1")))

# 271

ABCO_high_sun_seedling <- ABCO_high_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

ABCO_high_sun_seedling <- ABCO_high_sun_seedling %>% filter(valid_data == TRUE)

ABCO_high_sun_seedling_cleaned <- ABCO_high_sun_seedling %>%  filter(!row_number() %in% c(5, 8, 16, 19, 24, 25, 26, 27, 28, 33, 37, 52, 57,61,62,65,66))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_high_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO high elevation, sun exposed seedling",
     legend = TRUE,
     xlim = c(0.5,7.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.39191 4.245323 4.686521
```

```{r}
ABCO_high_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("128")))

#282
  
ABCO_high_shade_seedling <- ABCO_high_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_high_shade_seedling <- ABCO_high_shade_seedling %>% filter(valid_data == TRUE)

ABCO_high_shade_seedling_cleaned <- ABCO_high_shade_seedling %>%  filter(!row_number() %in% c(1, 17, 18, 21, 22, 23, 28, 29, 32, 33, 35))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_high_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO high elevation, shaded seedling",
     legend = TRUE,
     xlim = c(1,6.5),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.419759 4.396273 4.511261
```

```{r}
ABCO_high_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("235.2", "220.1", "297.1", "276.2")))

#235.1, 276.1 :(

ABCO_high_sun_sapling <- ABCO_high_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_high_sun_sapling <- ABCO_high_sun_sapling %>% filter(valid_data == TRUE)

ABCO_high_sun_sapling_cleaned <- ABCO_high_sun_sapling %>%  filter(!row_number() %in% c(2,3,4,5,6,7,8,9, 24, 26, 33, 34, 35, 36, 38))


# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_high_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO high elevation, sun exposed sapling",
     legend = TRUE,
     xlim= c(0.5, 7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.777402 3.648038 3.895114

```

```{r}
ABCO_high_shade_sapling <-vc_all2 %>% 
  filter(tree %in% c("60.1","281", "307.1"))

#"85.1" <- useable but needs kmax reassigned 

ABCO_high_shade_sapling <- ABCO_high_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABCO_high_shade_sapling <- ABCO_high_shade_sapling %>% filter(valid_data == TRUE)

ABCO_high_shade_sapling_cleaned <- ABCO_high_shade_sapling %>%  filter(!row_number() %in% c(1, 2, 4, 26, 27, 33, 36, 37, 38, 39, 43, 70, 81, 82, 83, 84, 88, 89))


# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABCO_high_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABCO high elevation, shaded sapling",
     legend = TRUE,
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.04298 3.940145 4.111902
```

#ABMA P50
##ABMA -- high elevation
```{r}
ABMA_high_sun_seedling <- vc_all2 %>% 
  filter((tree %in% c("71.1", "291")))

ABMA_high_sun_seedling <- ABMA_high_sun_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  

ABMA_high_sun_seedling <- ABMA_high_sun_seedling %>% filter(valid_data == TRUE)

ABMA_high_sun_seedling_cleaned <- ABMA_high_sun_seedling %>%  filter(!row_number() %in% c(1, 3,4,5,6,7,8,9,10,11, 16,18,19,21,22,23, 36))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABMA_high_sun_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABMA high elevation, sun exposed seedling",
     legend = TRUE)

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.241517 4.172947 4.279737

```

```{r}
ABMA_high_shade_seedling <- vc_all2 %>% 
  filter((tree %in% c("136.1", "136.2")))

#240.1, 136.2

ABMA_high_shade_seedling <- ABMA_high_shade_seedling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABMA_high_shade_seedling <- ABMA_high_shade_seedling %>% filter(valid_data == TRUE)

ABMA_high_shade_seedling_cleaned <- 
  ABMA_high_shade_seedling %>%  filter(!row_number() %in% c(2, 3, 8, 11, 14, 15, 16, 18, 19, 21, 22, 23, 24, 26, 28, 29, 30, 33, 34, 38, 42, 43, 45, 46, 47, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABMA_high_shade_seedling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)


coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABMA high elevation, shaded seedling",
     legend = TRUE)

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.337336  4.28198 4.447232

```

```{r}
ABMA_high_sun_sapling <-vc_all2 %>% 
  filter((tree %in% c("273.2", "233.1","290.1", "215.1")))

#215.1
#273.1 <- still useable 

ABMA_high_sun_sapling <- ABMA_high_sun_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABMA_high_sun_sapling <- ABMA_high_sun_sapling %>% filter(valid_data == TRUE)

ABMA_high_sun_sapling_cleaned <- 
  ABMA_high_sun_sapling %>%  filter(!row_number() %in% c(2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 30, 52, 53, 64, 67, 76))

#24, 25, 36, 39, 48, 50

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABMA_high_sun_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABMA high elevation, sun exposed sapling",
     legend = TRUE,
     xlim = c(0.5,7),
     ylim = c(0,1))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 4.132574 4.046866 4.181001

```

```{r}
ABMA_high_shade_sapling <-vc_all2 %>% 
  filter(tree %in% c("280.2", "308.1"))

#280.1

ABMA_high_shade_sapling <- ABMA_high_shade_sapling %>%
  mutate(k = format(k, scientific = FALSE),  # Ensure 'k' is formatted as non-scientific
         valid_data = ifelse(plc_new >= 0, TRUE, FALSE))  
ABMA_high_shade_sapling <- ABMA_high_shade_sapling %>% filter(valid_data == TRUE)

ABMA_high_shade_sapling_cleaned <- 
  ABMA_high_shade_sapling %>%  filter(!row_number() %in% c(9, 20, 21, 22, 27, 39, 46, 47))

# Fit the model using only rows where plc_new >= 0
pfit <- fitplcs(ABMA_high_shade_sapling_cleaned, "tree", varnames = c(PLC = "plc_new", WP = "mpa"), nboot = 5)

coef(pfit)
plot(pfit,
     onepanel = T, 
     plotci = F, 
     pxlinecol = "black",
     main = "ABMA high elevation, shaded sapling",
     legend = TRUE,
     xlim = c(0.5,7))

coef(pfit) %>% 
  clean_names() %>% 
  filter(parameter == "PX") %>%
  summarise(mean_P50 = mean(estimate), 
            mean_lwr = mean(boot_2_5_percent), 
            mean_upr = mean(boot_97_5_percent))

# mean_P50 mean_lwr mean_upr
# 3.635542 3.421669 3.904172
```

#species, site, size means
```{R}
trait_data1 <- trait_data1 %>%
  mutate(P50_mean = case_when(
    size == "seedling" & microsite == "sun"   & species == "ABCO" & elevation == "high" ~ 4.39,
    size == "seedling" & microsite == "int"   & species == "ABCO" & elevation == "high" ~ 4.40,
    size == "seedling" & microsite == "shade" & species == "ABCO" & elevation == "high" ~ 4.42,
    size == "seedling" & microsite == "sun"   & species == "ABCO" & elevation == "low" ~ 4.58,
    size == "seedling" & microsite == "int" & species == "ABCO" & elevation == "low" ~ 4.53,
    size == "seedling" & microsite == "shade" & species == "ABCO" & elevation == "low" ~ 4.48,
    size == "sapling" & microsite == "sun"   & species == "ABCO" & elevation == "high" ~ 3.77,
    size == "sapling" & microsite == "int"   & species == "ABCO" & elevation == "high" ~ 3.9,
    size == "sapling" & microsite == "shade" & species == "ABCO" & elevation == "high" ~ 4.04,
    size == "sapling" & microsite == "sun"   & species == "ABCO" & elevation == "low" ~ 4.48,
    size == "sapling" & microsite == "int"   & species == "ABCO" & elevation == "low" ~ 4.25,
    size == "sapling" & microsite == "shade" & species == "ABCO" & elevation == "low" ~ 4.02,
    
    size == "seedling" & microsite == "sun"   & species == "PILA" & elevation == "high" ~ 3.98,
    size == "seedling" & microsite == "int" & species == "PILA" & elevation == "high" ~ 3.96,
    size == "seedling" & microsite == "shade" & species == "PILA" & elevation == "high" ~ 3.94,
    size == "seedling" & microsite == "sun"   & species == "PILA" & elevation == "low" ~ 3.94,
    size == "seedling" & microsite == "int" & species == "PILA" & elevation == "low" ~ 3.68,
    size == "seedling" & microsite == "shade" & species == "PILA" & elevation == "low" ~ 3.42,
    size == "sapling" & microsite == "sun"   & species == "PILA" & elevation == "high" ~ 3.40,
    size == "sapling" & microsite == "int"   & species == "PILA" & elevation == "high" ~ 3.38,
    size == "sapling" & microsite == "shade" & species == "PILA" & elevation == "high" ~ 3.37,
    size == "sapling" & microsite == "sun"   & species == "PILA" & elevation == "low" ~ 4.03,
    size == "sapling" & microsite == "int" & species == "PILA" & elevation == "low" ~ 3.56,
    size == "sapling" & microsite == "shade" & species == "PILA" & elevation == "low" ~ 3.09,
    
    size == "seedling" & microsite == "sun"   & species == "PIPO" & elevation == "high" ~ 4.19,
    size == "seedling" & microsite == "int" & species == "PIPO" & elevation == "high" ~ 4.06,
    size == "seedling" & microsite == "shade" & species == "PIPO" & elevation == "high" ~ 3.93,
    size == "seedling" & microsite == "sun"   & species == "PIPO" & elevation == "low" ~ 4.5,
    size == "seedling" & microsite == "int" & species == "PIPO" & elevation == "low" ~ 4.54,
    size == "seedling" & microsite == "shade" & species == "PIPO" & elevation == "low" ~ 4.58,
    size == "sapling" & microsite == "sun"   & species == "PIPO" & elevation == "high" ~ 4.04,
    size == "sapling" & microsite == "int" & species == "PIPO" & elevation == "high" ~ 3.75,
    size == "sapling" & microsite == "shade" & species == "PIPO" & elevation == "high" ~ 3.46,
    size == "sapling" & microsite == "sun"   & species == "PIPO" & elevation == "low" ~ 4.24,
    size == "sapling" & microsite == "int" & species == "PIPO" & elevation == "low" ~ 4.21,
    size == "sapling" & microsite == "shade" & species == "PIPO" & elevation == "low" ~ 4.19,
    
    size == "seedling" & microsite == "sun"   & species == "ABMA" & elevation == "high" ~ 4.24,
    size == "seedling" & microsite == "int" & species == "ABMA" & elevation == "high" ~ 4.28,
    size == "seedling" & microsite == "shade" & species == "ABMA" & elevation == "high" ~ 4.33,
    size == "sapling" & microsite == "sun"   & species == "ABMA" & elevation == "high" ~ 4.13,
    size == "seedling" & microsite == "int" & species == "ABMA" & elevation == "high" ~ 3.88,
    size == "sapling" & microsite == "shade" & species == "ABMA" & elevation == "high" ~ 3.63,
    TRUE ~ NA_real_  # default value if none of the conditions match
  ))
```


